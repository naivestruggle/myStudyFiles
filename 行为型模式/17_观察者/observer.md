# 1、需求

天气预报项目需求：

- 气象站可以将每天测量到的温度、湿度、气压等等以公告的形式发布出去（比如发布到自己的网站或第三方）
- 需要设计开发型API，便于其他第三方也能接入气象站获取数据。
- 提供温度、气压和湿度的接口
- 测量数据更新时，要能实时的通知给第三方

# 2、普通方案解决

通过对气象站项目的分析，我们可以初步设计出一个WeatherData类

## 2.1、调用者自己获取的方式

- 调用者自己获取的方式
  - ![1563845456081](images\普通方式解决问题1.png)
  - 说明
    - 通过getXxx方法，可以让第三方接入，并得到相关信息
    - 当数据有更新时，气象站通过调用dataChange()方法去更新数据，当第三方再次获取时，就能得到最新数据，当然也可以**推送**。
  - 代码实现
  - 

## 2.2、提供者推送的方式

- 提供者推送

  - ![1563846267886](images\普通方式解决问题2.png)

  - 说明

    - CurrentConfitions（当前的天气情况）
    - 可以理解成是我们气象站的网站   //**推送**

  - 代码实现

  - 问题分析

    - 其他第三方接入气象站获取数据的问题

    - 无法在运行时动态地添加第三方（新浪网站）

      ```java
      //在WeatherData中，当增加一个第三方，需要创建一个对应的第三方的公告板对象，并加入到dataChange中，不利于维护，也不是动态加入
      public void dataChange(){
          currentConditions.update(getTemperature(),getPressure(),getHumidity());
      }
      ```


# 3、观察者模式

## 3.1、观察者模式原理

![1563855089577](images\观察者模式定牛奶.png)

- 观察者模式类似牛奶业务

  - 奶站/气象局：Subject
  - 用户/第三方网站：Observer

- Subject：登记注册、移除和通知

  - registerObserver：注册
  - removeObserver：移除
  - notifyObserver：通知所有的注册用户，根据不同需求可以是更新数据，让用户来取，也可能是实时推送，看具体需求定

- Observer：接受输入

  ![1563855317116](images\Observer.png)

- 观察者模式：对象之间**多对一依赖**的一种设计方案，被依赖的对象为Subject，依赖的对象为Observer,Subject通知Observer变化，比如这里的奶站是Subject，是1的一方。用户是Observer，是多的一方。

## 3.2、观察者模式解决问题

- 类图

  ![1563856955468](images\观察者模式解决问题类图.png)

- 代码实例（observer）

# 4、观察者模式的好处

- 观察者模式设计后，会以集合的方式来管理用户（Observer），包括注册、移除和通知。
- 这样，我们增加观察者（这里可以理解成一个新的公告板），就不需要去修改核心类WeatherData，遵守了ocp原则。

# 5、观察者模式在jdk应用的源码分析

- jdk的Observable类就使用了观察者模式

