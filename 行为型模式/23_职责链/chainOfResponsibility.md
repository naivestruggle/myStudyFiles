# 1、需求

学校OA系统的采购审批项目：需求是

- 采购员采购教学器材
- 如果金额小于等于5000，由教学主任审批(0<=x<=5000)
- 如果金额小于等于10000，由院长审批(5000<x<=10000)
- 如果金额小于等于30000，由副校长审批(10000<x<=30000）
- 如果金额超过30000以上，有校长审批（30000<x）
  

# 2、传统方式解决

## 2.1、类图

![1564020403593](images\传统方式解决问题类图.png)

## 2.2、传统方式分析

- 传统方式是：接收到一个采购请求后，根据采购金额来调用对应的Approver(审批人）完成审批。
- **传统方式的问题分析**：客户端这里会使用到分支判断（比如switch)来对不同的采购请求处理，这样就存在如下问题
  - 如果各个级别的人员审批金额发生变化，在客户端的也需要变化
  - 客户端必须明确的知道有多少个审批级别和访问

- 这样对一个采购请求进行处理和Approver(审批人）就存在强耦合关系，不利于代码的扩展和维护
- 解决方案=》**职责链模式**

# 3、职责链模式

## 3.1、基本介绍

- 职责链模式（Chain Of Responsibility Pattern），又叫责任链模式，为请求创建一个接收者对象的链。这种设计模式对请求的发送者和接收者进行解耦。
- 职责链模式通常每个接收者都包含对另一个接收者的引用。如果一个对象不能处理请求，那么它会把相同的请求传给下一个接收者，以此类推
- 这种类型的设计模式属于行为型模式

## 3.2、原理类图

![1564021198916](images\职责链模式原理类图.png)

- 说明
  - Handler：抽象的处理者，定义了一个处理请求的接口，同时含有另外Handler
  - ConcreteHandlerA，B是具体的处理者，处理它自己负责的请求，可以访问它的后继者（即下一个处理者），如果可以处理当前请求，则处理，否则就将该请求交给后继者去处理，从而形成一个职责链
  - Request：含有很多属性，表示一个请求

# 4、使用职责链模式解决问题

## 4.1、类图

![1564021846139](images\职责链模式解决问题类图.png)

## 4.2、代码

# 5、职责链模式在SpringMVC框架中的应用

- SpringMVC的HandlerExecutionChain类就使用到职责链模式

# 6、职责链模式的注意事项和细节

- 将请求和处理分开，实现解耦，提高系统的灵活性
- 简化了对象，使对象不需要知道链的结构
- 性能会受到影响，特别是在链比较长的时候，因此需控制链中最大节点数量，一般通过在Handler中设置一个最大节点数量，在setNext（)方法中判断是否已经超过阀值，超过则不允许该链建立，避免出现超长链无意识地破坏系统性能
- 调试不方便。采用了类似递归的方式，调试时逻辑可能比较复杂
- 最佳应用场景：有多个对象可以处理同一个请求时，比如：多级请求、请假/加薪等审批流程、Java Web中Tomcat对Encoding的处理、拦截器